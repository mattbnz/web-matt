---
title: Don't deploy DNSSEC
subtitle: The costs exceed the gains
date: 2023-05-31T08:14:32+12:00
draft: true

categories:
  - Technology
---

On Monday evening and continuing through yesterday the .nz ccTLD suffered an availability incident triggered by an annual DNSSEC key rotation procedure. The incident caused widespread disruption for .nz domains (including several of mine!) and required numerous resolver operators to perform urgent cache flushes to reduce the duration of the disruption prior to cached records naturally expiring.

Incidents of this nature are unfortunately not uncommon. While the precise triggers and contributing factors that led to this particular incident are not yet known, the pattern is clear: DNSSEC as a protocol is a complex and risky to deploy.

When faced with a complex and risky deployment choice, the obvious question to answer is whether the benefits that the deployment brings are worth the costs and the risk involved.

**For almost all domains and use-cases, the costs and risks of deploying DNSSEC outweigh the benefits it provides.**

While DNSSEC has been struggling to gain adoption and deployment, the TLS ecosystem has made huge advances in both coverage and trustworthiness, to the point where the incremental benefits that DNSSEC provides above and beyond what TLS at the application layer can provide are too small to justify the costs and risks that DNSSEC brings with it.

Ironically, TLDs (including ccTLDs such as .nz) are one of the few exceptional use-cases where DNSSEC might be justified. This is not an argument that InternetNZ should turn off DNSSEC on .nz because of this incident. They should publish a comprehensive and transparent incident report so we can all learn as much as possible about how to avoid a repeat.

But for the rest of us, this incident and the many before it serve as a warning. DNSSEC is hard to do right, and easy to do wrong. The costs are so high they outweigh the benefits. To examine why that's the case in more detail let's start by recapping the problem we're trying to solve.


### Problem Statement

At a very simplified level the Internet consists of services (applications) and users who want to make use of those services in a way that achieves and balances the [3 core tenets of information security](https://en.wikipedia.org/wiki/Information_security): Confidentiality (no-one can eavesdrop on the data I'm sending/receiving), Integrity (no-one can alter the data I send/receive) and Availability (the service is there to use whenever I need it).

Achieving these tenets requires at minimum that the protocols used to interact with Internet services provide mechanisms for authenticating and verifying that the service being communicated with is the correct and intended service and not an imposter, as well as the capability to encrypt/hash all communications in flight to prevent eavesdropping/modification, and to achieve all these properties while maintaining an acceptable level of availability and performance.

Generally, user interaction with a service begins with a name (e.g. www.mattb.nz) which then has to be translated into an IP address to which an application layer request can then be sent over the appropriate protocol (e.g HTTP). This translation happens via the DNS system, and as the first step in the process of communicating with an Internet service it is an attractive and logical target for an attacker.

Unfortunately, as one of the Internet's earliest protocols DNS is also a vulnerable target. Various spoofing and cache poisoning attacks are well documented, have been observed in the wild and by default DNS provides no mechanism for a user to validate that the DNS response they received is what the service operator intended.

As we'll examine in the next section, DNSSEC aims to solve this problem and provide integrity for DNS responses. Gaining an integrity guarantee on this first step in the process of communicating with an Internet service is an improvement but not a complete solution. Even with a trusted IP address to connect to (whether from DNSSEC, or manually configured) the application layer protocol (e.g. HTTP) cannot trust the network and must still use a protocol such as TLS to establish confidentiality and integrity guarantees for the application communication.

In summary, the problem is to provide confidentiality, integrity and availability for the communication between a user and an Internet service. DNSSEC can provide confidence in the integrity of a subset of the data required for the communication, but the majority of the solution must be and is provided at the application layer regardless of whether or not DNSSEC is in use.

Understanding the importance of an integrity guarantee provided by DNSSEC to the security of the overall communication (aka the size of the benefit DNSSEC provides) is key to evaluating the cost/benefit trade-off for deploying DNSSEC. We are evaluating DNSSEC's value in the context of solving the overall problem, not in the context of solving DNS-specific attacks.

### The theory of DNSSEC

DNSSEC aims to supplement the basic DNS protocol to also provide clients with guarantees that the responses they are receiving are *authentic* (originate from the owner of the domain being resolved, not any other party) and have maintained their *integrity* (contain the original unmodified data from the owner of the domain) in the course of their resolution.

The threat of cache poisoning and spoofing attacks on DNS is very real with plenty of "in the wild" reports of observed attacks. When widely deployed and operating correctly DNSSEC effectively neutralizes these attacks - there is clearly benefit to be gained by adding integrity to the DNS, not only for the improvement to the basic name to IP use-case, but also enabling new use-cases (such as DANE/TLSA) that are only possible when integrity is guaranteed.

DNSSEC has real benefits, but like any benefit achieving those gains comes at a cost.

## DNSSEC's Costs

The primary cost of DNSSEC is increased complexity across the DNS stack from the codebase to the resource requirements and finally the operational and human considerations.

This increased complexity primarily manifests as a reduction in availability due to outages. An exacerbating factor here is the distributed nature of DNS caches and TTLs meaning that even once the underlying trigger for an outage has been fixed, clients may continue to experience availability issues until the TTL on the bad records expires, which often can be up to 24hrs.

## Application layer (web/HTTP) improvements

Historically the state of security at the web application (HTTP) layer has been messy and unclear which increased the value of providing integrity at the DNS layer. SSL certificates were expensive and hard to obtain, the CA ecosystem was a cesspit of poor practices and unclear trust relationships, the appeal of being able to bypass these risks by trusting the integrity of the DNS layer to provide the necessary data to then secure the application layer was compelling.

And yet, despite the compelling potential benefits that widespread DNSSEC deployment promised, what we have observed over the past 10 years instead is that DNSSEC deployment has languished, while the web security ecosystem has flourished and improved in leaps and bounds to the point where an end-user today can have significant confidence that their HTTPS sessions are secure in all dimensions regardless of whether or not DNSSEC is in use. The improvements in web security have eliminated all the benefits DNSSEC provides. A choice to deploy DNSSEC to protect HTTP traffic today is a choice to take on additional costs to reduce your availability without improving security.

## non-HTTP applications

For non-HTTP protocols the story is slightly more complex as there has not been as much evolution and development of the security infrastructure, it is claimed that DNSSEC still has worthwhile benefits to offer here that might justify the costs of deployment.

I think the argument is actually the other direction - the costs of DNSSEC deployment are fixed regardless of how many protocols you are using it to protect, without the benefits of protecting HTTP via DNSSEC these non-HTTP protocols must now bear the full cost of demonstrating that the benefits they can gain outweigh the costs of deployment - keeping in mind that a DNSSEC error is likely to impact an entire zone, causing availability issue for your (typically more valuable) web traffic even if you were only aiming to protect your non-HTTP resources with DNSSEC.

From this perspective, taking the time/effort that would be spent attempting to reliably deploy DNSSEC to protect non-HTTP applications would be much better spent enabling those applications to instead benefit from the SSL ecosystem improvements. MTA-STS provides a clear worked example of the feasibility of this approach, and while the full set of benefits and protections are not yet available, there's significant protection already in place in the ecosystem that you piggy-back on and the collective effort saved from not deploying DNSSEC would go a long way to bringing web-equivalent protections to these additional applications.

## SSL vs alternative crypto root

Buying in to this argument requires accepting the fundamental role of the CA authorities, which as noted above has historically been garbage and not desirable. Many have argued that the DNS trust hierarchy is superior to the CA ecosystem for this reason. I am not convinced.

For one, by nature of being a hierarchy their are significant single points of failure and trust that must be continuously monitored and verified to have confidence in the overall system.

Secondly, the expensse and effort involved in providing that oversight and audit function would be better applied to one ecosystem, rather than two.

## Big providers vs little

Another common argument is that the current DNSSEC costs are simply teething problems that will reduce as the software and tooling matures, or that you can avoid by outsourcing the management and complexity to larger providers to take care of for you.

I don't find these arguments compelling, DNSSEC is already more than 15 years old as a protocol which is plenty of time for improvements and cost reductions in tooling and software to occur. The fact that these improvements have only been piecemeal and deployment rate continues to languish, is a strong refutation of this argument - I see nothing on the horizon that is likely to change or alter this state.

The issue with outsourcing the management and complexity to a trusted piece of software or provider is that its simply delaying the inevitable. You likely can get years of trouble-free operation with this approach until you want to change software or provider at which point you run head-first into the complexity and risks, and worse it's a novel and unfamiliar situation, further increasing the risk of error and the cost of migration. Creating this sort of software/provider lock-in to mitigate the downsides of the DNSSEC protocol is not a desirable outcome.

## Summing up

For the vast majority of domains and use-cases there is simply no net benefit to deploying DNSSEC in 2023. The threats that DNSSEC prevents against are already amply defended by the huge improvements in the SSL ecosystem at the application layer that have occurred over the last 10 years, while the costs and complexities of DNS deployment have at best remained constant, and probably increased. Your time and effort is much better spent on ensuring a robust and well-maintained SSL deployment at your application layer(s), accepting that the DNS layer cannot reliably provide integrity for you and should be treated as untrusted.

Unfortunately, ccTLDs like .nz whose outage triggered this post, remain within the minority of use-cases where DNSSEC deployment cannot be reversed and will have to be maintained given their infrastructural position in the DNS ecosystem. This is a cost these organisations will have to bear going forward. While the full incident report of what went wrong with .nz is not yet available, from the interim report it sounds like there were some missed detection opportunities, and it will be important for InternetNZ to publish a full and comprehensive review so that the learnings and improvements this latest incident can drive can be fully realised both in .nz and by other operators stuck with the unenviable task of trying to safely operate DNSSEC.